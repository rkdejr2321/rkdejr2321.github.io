---
title: "TerraformμΌλ΅ λ„¤μ΄λ²„ν΄λΌμ°λ“ μΈν”„λΌ κµ¬μ¶•ν•κΈ°"
excerpt: "Provisioning NaverCloud Infra by Terraform"
autor_porfile: true
share: false
relate: false
categories:
    - NCP
---

# μ½”λ“ ν•νƒμ μΈν”„λΌ λ° λ„κµ¬
IaC (Infastructure as a Code)λ” μ½”λ“ κΈ°λ°μΌλ΅ μΈν”„λΌλ¥Ό μ •μν•μ—¬ ν”„λ΅λΉ„μ €λ‹ν•κ³  κ΄€λ¦¬ν•λ” λ°©μ‹

μ½”λ“ κΈ°λ°μ΄κΈ° λ•λ¬Έμ— μΈν”„λΌλ¥Ό ν‘μ¤€ν™”λ ν¨ν„΄μ„ μ‚¬μ©ν•μ—¬ λ°°ν¬ν•κ³ , μµμ‹  λ²„μ „μΌλ΅ μ—…λ°μ΄νΈν•κ±°λ‚, λ³µμ λ¥Ό ν†µν•΄ λ‹¤μ–‘ν• ν™κ²½μ—μ„ λ™μΌν• μΈν”„λΌ κµ¬μ„± λ§¤μΉ­μ΄ κ°€λ¥

## μ¥μ 
IaCλ΅ μΈν”„λΌ λ¦¬μ†μ¤λ¥Ό κµ¬μ„±ν–‡μ„ λ• self-service ν•νƒλ¥Ό μΈν”„λΌλ¥Ό μ„λΉ„μ¤ν™” κ°€λ¥ν•λ©°, μ•μ „ν•κ² λ¦¬μ†μ¤λ¥Ό μƒμ„±ν•κ³  λ³µκµ¬ κ°€λ¥ν•λ‹¤.

λν• λ¬Έμ„ν™”μ™€ λ²„μ „ κ΄€λ¦¬κ°€ μ‰¬μ› λ³€κ²½ μ΄λ ¥ λ° μ„λΉ„μ¤ μν–¥λ„λ¥Ό λ…ν™•ν•κ² νμ•… κ°€λ¥ν•λ‹¤.  
ν”„λ΅λ•νΈ ν™κ²½μ—μ„ μΈν”„λΌμ— λ€ν• λ³€κ²½μ΄ ν•„μ”ν•  κ²½μ° λ³€κ²½ λ¶€λ¶„μ— λ€ν• μν–¥λ„λ¥Ό νμ•… κ°€λ¥ν•λ‹¤λ” μ μ΄ μ¤‘μ”

> sefl-serviceλ€? μ„λΉ„μ¤μ λ‹΄λ‹Ήμμ μ§€μ› μ—†μ΄ κ³ κ°μ΄ μ¤μ¤λ΅ λ¦¬μ†μ¤μ— μ—‘μ„Έμ¤ν•λ” λ°©μ‹

## λ„κµ¬ λ° νΉμ„±
ν΄λΌμ°λ“ ν”λ«νΌ λ³„ IaC λ„κµ¬κ°€ μ΅΄μ¬ν•λ©°, κ° ν΄λΌμ°λ“ APIλ¥Ό ν†µν•΄ μΈν„°νμ΄μ¤ ν•νƒλ΅ μ΅΄μ¬ν•λ” Terraformλ„ μ΅΄μ¬ν•λ‹¤.

|λ„κµ¬|νΉμ„±|
|---|---|
|AWS CloudFormation|AWS λ¦¬μ†μ¤ μƒμ„±μ„ μ„ν• IaC λ„κµ¬λ΅ ν…ν”λ¦ΏμΌλ΅ YAML, JSONμ„ μ‚¬μ©ν•λ‹¤.|
|Googlce Cloud Deployment Manager|GCP λ¦¬μ†μ¤ μƒμ„±μ„ μ„ν• IaC λ„κµ¬λ΅ YAML, Python, Jinja2λ¥Ό μ§€μ›ν•λ‹¤.|
|Terraform| κ° ν”λ«νΌ λ³„ λ™μΌν• μΈν„°νμ΄μ¤ ν•νƒλ΅ μ κ³µν•λ” λ„κµ¬λ΅ HCL, JSON μ§€μ›|

* μ¥μ : ν”λ«νΌ λ³„ μƒλ΅μ΄ μ„λΉ„μ¤κ°€ μ¶μ‹λλ©΄ ν…λΌνΌμ—μ„ μ κ³µν•κΈ° μ „μ— ν”λ«νΌμ΄ μ κ³µν•λ” μƒν’μ—μ„ μ§€μ›
* λ‹¨μ : νΉμ • λ²¤λ”μ— λ½μΈλ  κ°€λ¥ μ΅΄μ¬

# Hachicorp Terraform
HashiCropμ—μ„ κ°λ°ν• IAC λ„κµ¬λ΅ μ½”λ“λ¥Ό ν†µν•΄ μΈν”„λΌλ¥Ό κµ¬μ¶• / μ΄μ / κ΄€λ¦¬ν•  μ μκ² ν•΄μ£Όλ” μ¤ν”μ†μ¤ μ†ν”„νΈμ›¨μ–΄

ν΄λΌμ°λ“ ν”λ«νΌμ— μΆ…μ†λμ§€ μ•κ³  λ©€ν‹° ν΄λΌμ°λ“ ν™κ²½μ—μ„ μ‚¬μ©κ°€λ¥ν•λ©°, μ‹¤ ν™κ²½μ— μ μ© μ „ ν…μ¤νΈ κΈ°λ¥μ„ μ κ³µν•μ—¬ μ„λΉ„μ¤ μν•­λ„λ¥Ό μ‚¬μ „μ— ν™•μΈ κ°€λ¥ν•λ‹¤.

<img src="../../assets/images/blogImg/ncp-terraform-status.png"/>

* β• ν‘μ‹: μƒλ΅ μƒμ„±λ  λ¦¬μ†μ¤
* β– ν‘μ‹: μ‚­μ λ  λ¦¬μ†μ¤
* γ€°οΈ ν‘μ‹: λ³€κ²½λ  λ¦¬μ†μ¤

## ν…λΌνΌ νΉμ§•
* Infrasctructure as Code
  * μ½”λ“ κΈ°λ°μΌλ΅ μ •μ
* Excution Plans
  * μ‹¤ ν™κ²½μ— μ μ© μ „ μ‚¬μ „ ν…μ¤νΈ κΈ°λ¥ μ κ³µ
* Resource Graph
  * ν΄λΌμ°λ“ ν”λ«νΌλ§λ‹¤ λ¦¬μ†μ¤μ— λ€ν• μμ΅΄μ„±μ„ μ‚¬μ©μκ°€ κ³ λ―Όν•  ν•„μ”κ°€ μ—†μ΄ ν…λΌνΌμ—μ„ κ·Έλν”„λ¥Ό ν†µν•΄ μμ΅΄μ„±μ„ ν™•μΈν•λ” κΈ°λ¥ μ κ³µ 
* Change Automatic
  * μμ‘μ—… μ—†μ΄ μλ™ν™” κ°€λ¥

## ν…λΌνΌ λ…λ Ήμ–΄
ν…λΌνΌμ—λ” λ‹¤μ–‘ν• λ…λ Ήμ–΄κ°€ μμ§€λ§ λ€ν‘μ μΌλ΅ μ‚¬μ©ν•λ” λ…λ Ήμ–΄λ” terraform init / plan / apply / detroy / graphκ°€ μλ‹¤.
- **terraform init**: ν„μ¬ λ””λ ‰ν† λ¦¬μ— μλ” .tf νμΌμ„ μ½μ–΄ ν•„μ”ν• ν”λ¬κ·ΈμΈλ“¤μ„ λ‹¤μ΄λ΅λ“ ν•κ³  .terraform λ””λ ‰ν† λ¦¬μ— λ‹¤μ΄λ΅λ“ν• λ¨λ“μ„ λ³΄κ΄€
- **terraform plan**: terraform κµ¬μ„±μ„ κ²€ν† ν•κ³  μ‹¤ν–‰ μ „μ— μ–΄λ–¤ λ³€κ²½μ‚¬ν•­μ΄ λ°μƒν•λ”μ§€ ν™•μΈν•λ” μ©λ„μ΄λ©° μ‹¤μ λ΅ λ³€κ²½μ„ μν–‰ν•μ§€λ” μ•μ
- **terraform apply**: terraform κµ¬μ„±μ— μ •μλ λ‚΄μ©μ„ λ°”νƒ•μΌλ΅ μΈν”„λΌλ¥Ό κµ¬μ„±ν•κ±°λ‚ μ—…λ°μ΄νΈ ν•λ©° errorκ°€ μ—†λ‹¤λ©΄ λ³€κ²½λ μƒνƒλ¥Ό μ €μ¥
- **terraform destroy**: terraformμ„ μ‚¬μ©ν•μ—¬ μƒμ„±λ μΈν”„λΌμ¤νΈλ­μ²λ¥Ό μ‚­μ 
- **terraform graph**: λ¦¬μ†μ¤ κ°„ μμ΅΄μ„±μ„ μ¶λ ¥

## ν…λΌνΌμ μ›ν¬ν”λ΅μ°
<img src="../../assets/images/blogImg/ncp-terraform-workflow.png"/>

Write β†’ Plan β†’ Apply

- **write**: μΈν”„λΌ ν™κ²½μ„ HCLλ΅ μ‘μ„±
- **plan**: μΈν”„λΌ λ° κµ¬μ„±μ„ κΈ°λ°μΌλ΅ μƒμ„±, μμ •, μ‚­μ ν•κΈ° μ„ν• μ‹¤ν–‰ κ³„νμ„ ν™•μΈ
- **apply**: ν™•μΈλ μ‹¤ν–‰ κ³„νμ„ λ¦¬μ†μ¤ μΆ…μ†μ„±μ„ μ μ§€ν•λ©΄μ„ μ¬λ°”λ¥Έ μμ„λ΅ μ‘μ—…μ„ μν–‰

Apply μν–‰ ν›„ .tfstateλΌλ” νμΌμ΄ μƒμ„±λλ”λ° μ΄ νμΌμ€ μ‹¤μ  ν™κ²½μ— μ μ©λ λ¦¬μ†μ¤λ¥Ό Json ν•νƒμ νμΌλ΅ λ‚νƒ€λ‚Έ κ²ƒμ΄λ‹¤. .tfstate νμΌμ„ λΉ„κµν•μ—¬ μ›λ³µν•  μ μκ³  μƒλ΅μ΄ planμ„ μν–‰ν•  λ• κΈ°μ΅΄μ— μλ” .tfstate νμΌκ³Ό λΉ„κµν•μ—¬ λ³€κ²½λ μ‚¬ν•­μ„ λ³΄μ—¬μ¤„ λ• μ‚¬μ©ν•λ‹¤.


## ν…λΌνΌ μ‚¬μ©λ°©λ²•
κ°•μ μμƒμ—μ„ μ‚¬μ©ν• λ°λ¨ νμΌμ„ μ°Ύμ§€ λ»ν•μ€μ§€λ§ μ΄μ „ ν¬μ¤ν…μ— μλ” [Source μ‹λ¦¬μ¦λ¥Ό ν™μ©ν• μΈν”„λΌ μƒμ„± μλ™ν™”](https://rkdejr2321.github.io/ncp/ncp_source_series/)λ¥Ό λ³΄λ©΄ vpcλ¥Ό μƒμ„±ν•λ” ν…λΌνΌ μ½”λ“κ°€ λ‚μ™€μλ‹¤. μ°Έκ³ λ¶€νƒλ“λ¦½λ‹λ‹¤.π™‡β€β™‚οΈ


# Terraform in Naver Cloud Platformμ ν•κ³„
* μ μ–΄ κ°€λ¥ν• λ¦¬μ†μ¤ μ μ•½
  * server, block storage, public ip, lb, nas, port μ •λ„λ§ μ μ–΄ κ°€λ¥
* ACGμ κ²½μ° μ΄λ―Έ μƒμ„±λ κ²ƒμ„ ν•λ“ μ½”λ”©ν•΄μ„ μ‚¬μ© κ°€λ¥